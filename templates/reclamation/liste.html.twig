{% extends 'base.html.twig' %}

{% block body %}
	<div class="container mt-5">
		<h1 class="text-center text-primary fw-bold">üìã Liste des R√©clamations</h1>

		<div class="mb-4">
		<div class="mb-4">
    <div class="d-flex justify-content-between">
    <input type="text" id="search" class="form-control w-25" placeholder="üîç Rechercher par sujet ou description...">
        <form method="get" class="d-flex">
            <select name="etat" class="form-select w-auto" onchange="this.form.submit()">
                <option value="" selected>Tous les √âtats</option>
                <option value="en_attente" {% if app.request.get('etat') == 'en_attente' %} selected {% endif %}>En attente</option>
                <option value="trait√©" {% if app.request.get('etat') == 'trait√©' %} selected {% endif %}>Trait√©</option>
            </select>
        </form>
    </div>
</div>


		{% if reclamations is empty %}
			<p class="text-center text-muted mt-4">Aucune r√©clamation trouv√©e.</p>
		{% else %}
			<div class="table-responsive">
				<table id="reclamationTable" class="table table-hover table-striped align-middle shadow-lg rounded">
					<thead class="table-dark text-center">
						<tr>
							<th>ID</th>
							<th>Sujet</th>
							<th>Description</th>
							<th>Date de cr√©ation</th>
							<th>√âtat</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody class="text-center">
						{% for reclamation in reclamations %}
							<tr class="bg-white">
								<td>
									<strong>#{{ reclamation.id }}</strong>
								</td>
								<td>{{ reclamation.sujet }}</td>
								<td>{{ reclamation.description }}</td>
								<td>{{ reclamation.dateDebut|date('d/m/Y') }}</td>
								<td>
									{% if reclamation.etat == 'en_attente' %}
										<span class="badge bg-warning text-dark">üïí En attente</span>
									{% elseif reclamation.etat == 'trait√©' %}
										<span class="badge bg-success">‚úÖ Trait√©</span>
									{% else %}
										<span class="badge bg-secondary">‚ùì Non sp√©cifi√©e</span>
									{% endif %}
								</td>
								<td>
									<div class="d-flex justify-content-center">
										<a href="{{ path('modifier_reclamation', {'id': reclamation.id}) }}" style="margin-right: 10px;">
											<i class="bi bi-pencil" style="color: green;font-size: 20px;"></i>
										</a>
										<a href="{{ path('supprimer_reclamation', {'id': reclamation.id}) }}" onclick="return confirm('Voulez-vous vraiment supprimer cette r√©clamation ?');" style="margin-right: 10px;">
											<i class="bi bi-trash" style="color: red;font-size: 20px;"></i>
										</a>
										<a href="#" data-bs-toggle="modal" data-bs-target="#modalReponse{{ reclamation.id }}" class="text-info">
											<i class="bi bi-eye" style="font-size: 20px;"></i>
										</a>
									</div>

									<!-- Modal -->
									<div class="modal fade" id="modalReponse{{ reclamation.id }}" tabindex="-1" aria-labelledby="modalLabel{{ reclamation.id }}" aria-hidden="true">
										<div class="modal-dialog">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title" id="modalLabel{{ reclamation.id }}">R√©ponse</h5>
													<a href="#" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
														<i class="bi bi-x-circle" style="color: red;font-size: 20px;"></i>
													</a>
												</div>
												<div class="modal-body">
													{% if reclamation.reponse %}
														<p>{{ reclamation.reponse.contenu }}</p>
														<p class="text-muted">Date:
															{{ reclamation.reponse.dateDeReponse|date('d/m/Y H:i') }}</p>
													{% else %}
														<p class="text-muted">Aucune r√©ponse pour cette r√©clamation.</p>
													{% endif %}
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
												</div>
											</div>
										</div>
									</div>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		{% endif %}

		<div class="text-center mt-4" style="margin-bottom: 20px;">
			<a href="{{ path('ajouter_reclamation') }}" class="btn btn-success btn-lg shadow px-5 py-2 fw-bold">‚ûï Ajouter une R√©clamation</a>
		</div>
	</div>

	<style>
		body {
			background-color: #f0f8ff;
			font-family: 'Poppins', sans-serif;
		}
		.table {
			border-radius: 12px;
			overflow: hidden;
		}
		.table thead {
			background-color: #343a40;
			color: white;
		}
		.table tbody tr:hover {
			background-color: #e3f2fd;
			transition: 0.3s ease-in-out;
		}
		.btn {
			transition: all 0.3s ease-in-out;
		}
		.btn:hover {
			transform: scale(1.05);
		}
		.badge {
			font-size: 14px;
			padding: 8px 12px;
			border-radius: 8px;
		}
		/* Style for modal footer */
		.modal-footer {
			display: flex;
			justify-content: flex-end; /* Aligns buttons to the right */
			padding: 1rem; /* Adds space around the footer */
			border-top: 1px solid #dee2e6; /* Optional: Adds a border on top */
		}

		/* Style for the "Fermer" button */
		.modal-footer .btn-secondary {
			background-color: #6c757d; /* Custom background color */
			border-color: #6c757d; /* Matches the button border */
			padding: 0.5rem 1rem; /* Adjust padding */
			border-radius: 0.375rem; /* Rounded corners */
			color: white; /* Text color */
			font-weight: bold; /* Makes the text bold */
			transition: background-color 0.3s ease; /* Smooth hover transition */
		}

		/* Style for hover effect on the button */
		.modal-footer .btn-secondary:hover {
			background-color: #5a6268; /* Darker background on hover */
			border-color: #545b62; /* Darker border on hover */
		}

		/* Optional: Style for focus effect */
		.modal-footer .btn-secondary:focus {
			box-shadow: 0 0 0 0.2rem rgba(108, 117, 125, 0.5); /* Adds a focus ring */
		}

		.modal-header {
			border-bottom: none;
		}
		.modal-footer {
			border-top: none;
		}
		.modal-body p {
			font-size: 16px;
		}
	</style>
<script>
document.addEventListener("DOMContentLoaded", function () {
    let searchInput = document.getElementById("search");

    if (!searchInput) {
        console.error("Champ de recherche introuvable !");
        return;
    }

    searchInput.addEventListener("keyup", function () {
        let filter = this.value.toLowerCase();

        let rows = document.querySelectorAll("#reclamationTable tbody tr");

        rows.forEach(row => {
            let sujet = row.cells[1].textContent.toLowerCase();
            let description = row.cells[2].textContent.toLowerCase();

            if (sujet.startsWith(filter) || description.startsWith(filter)) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    });
});
</script>



{% endblock %}